import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.dataformat.xml.XmlMapper;

import java.io.File;
import java.util.*;

public class UniversalXmlParser {

    public static void main(String[] args) {
        try {
            File file = new File("input.xml");
            XmlMapper xmlMapper = new XmlMapper();

            JsonNode rootNode = xmlMapper.readTree(file);

            // List of all extracted segments as maps
            List<Map<String, String>> allExtractedData = new ArrayList<>();

            // Begin parsing the tree
            parseNode(rootNode, "", allExtractedData, new LinkedHashMap<>());

            // Print all parsed results
            for (Map<String, String> dataMap : allExtractedData) {
                System.out.println("---- Parsed Segment ----");
                dataMap.forEach((key, value) -> System.out.println(key + " -> " + value));
            }

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    private static void parseNode(JsonNode node, String currentPath,
                                  List<Map<String, String>> allResults,
                                  Map<String, String> currentMap) {

        if (node == null || node.isMissingNode()) return;

        if (node.isObject()) {
            boolean isLeafObject = true;
            Iterator<Map.Entry<String, JsonNode>> fields = node.fields();

            while (fields.hasNext()) {
                Map.Entry<String, JsonNode> entry = fields.next();
                String key = entry.getKey();
                JsonNode child = entry.getValue();
                String newPath = currentPath.isEmpty() ? key : currentPath + ":" + key;

                if (child.isValueNode()) {
                    currentMap.put(newPath, child.asText());
                } else {
                    isLeafObject = false;
                    parseNode(child, newPath, allResults, currentMap);
                }
            }

            // If it's a nested object with values, treat it as one logical segment
            if (!currentMap.isEmpty() && isLeafObject) {
                allResults.add(new LinkedHashMap<>(currentMap));
                currentMap.clear();
            }

        } else if (node.isArray()) {
            for (int i = 0; i < node.size(); i++) {
                JsonNode arrayNode = node.get(i);
                Map<String, String> newMap = new LinkedHashMap<>();
                parseNode(arrayNode, currentPath + "[" + i + "]", allResults, newMap);
                if (!newMap.isEmpty()) {
                    allResults.add(newMap);
                }
            }
        } else if (node.isValueNode()) {
            currentMap.put(currentPath, node.asText());
        }
    }
}
