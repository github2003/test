import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.dataformat.xml.XmlMapper;
import java.io.File;
import java.util.*;

public class XmlParser {
    public static void main(String[] args) {
        try {
            XmlMapper xmlMapper = new XmlMapper();
            
            // Read XML as JsonNode
            JsonNode rootNode = xmlMapper.readTree(new File("input.xml"));
            
            // Navigate to Loop-2300
            JsonNode loop2300Node = rootNode.at("/Loop-C/Loop-2300");
            
            // Map to store path:segment:element -> value
            Map<String, String> extractedData = new HashMap<>();
            
            // Iterate over all Loop-2400 nodes
            for (JsonNode loop2400Node : loop2300Node.findValues("Loop-2400")) {
                parseNode(loop2400Node, "Loop-2400", extractedData);
            }
            
            // Print extracted data
            System.out.println("Extracted Data from Loop-2400 and nested nodes:");
            extractedData.forEach((key, value) -> 
                System.out.println(key + " -> " + value));
            
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    private static void parseNode(JsonNode node, String currentPath, Map<String, String> extractedData) {
        if (node == null || node.isMissingNode()) {
            return;
        }

        // Handle different node types
        if (node.isObject()) {
            // Object node: process fields
            node.fields().forEachRemaining(entry -> {
                String key = entry.getKey();
                JsonNode value = entry.getValue();
                String newPath = currentPath + ":" + key;
                
                if (key.startsWith("segment-")) {
                    // Segment node: extract elements
                    if (value.isObject()) {
                        value.fields().forEachRemaining(element -> {
                            String elementPath = newPath + ":" + element.getKey();
                            extractedData.put(elementPath, element.getValue().asText());
                        });
                    }
                } else {
                    // Nested structure: recurse
                    parseNode(value, newPath, extractedData);
                }
            });
        } else if (node.isArray()) {
            // Array node: process each element
            for (int i = 0; i < node.size(); i++) {
                JsonNode arrayElement = node.get(i);
                String newPath = currentPath + "[" + i + "]";
                parseNode(arrayElement, newPath, extractedData);
            }
        } else if (node.isValueNode()) {
            // Value node: store the value if it's under a segment
            if (currentPath.contains("segment-")) {
                extractedData.put(currentPath, node.asText());
            }
        }
    }
}
